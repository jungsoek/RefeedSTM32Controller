# 251211목__개선 사항

## Controller10

### I2C HAL_BUSY로 인한 App 장애

```c
LOG("[ANS]", "FAIL");
```

해당 로그로 인해 App에서 단계 진행이 안되었습니다.

때문에,

```c
LOG("[ANS]", "SYSTEM_FAIL");
```

로 로그를 수정하였고,

FAIL이 되어도 App의 단계 진행은 계속되도록 조치하였습니다.

또한, 아래 코드와 같이 어느 부분에서 에러가 났는지 알리는 LOG Flag를 추가하였습니다.

```c
// -------- 결과 처리 --------
    if (error_code == 0)
    {
        LOG("[ANS]", "ALL_OK");
    }
    else
    {
        LOG("[ANS]", "SYSTEM_FAIL");

        // I2C 상태 자동 점검
        I2C_DumpDevices(&hi2c1);

        if (error_code & ERR_SIM)      LOG("[ERR]", "SIM_FAIL");
        if (error_code & ERR_LASER)    LOG("[ERR]", "LASER_FAIL");
        if (error_code & ERR_ULTRA)    LOG("[ERR]", "ULTRA_FAIL");
        if (error_code & ERR_LOADCELL) LOG("[ERR]", "LOADCELL_FAIL");
        if (error_code & ERR_WATER)    LOG("[ERR]", "WATER_SENSOR_FAIL");
    }
```

### 코드 간소화

#### main.c

아래와 같이 case마다 모듈화 및 함수 단일화를 진행했습니다.

```c
...
    
switch (FUNCTION) {
			case HANDSHAKE:
				Handshake();
				break;

			case VALIDATION:
				Validation();
				break;

			case POST_UCO:
				PostUCO();
			    break;

			case POST_PER:
				PostPeriodic();
				break;

			case OPEN_INPUT:
				DoorOpen_Measure();
				break;

			case CLOSE_INPUT:
				DoorClose_Measure();
				break;

			case RECHECK:
				Recheck();
				break;

			case UNLOCK_DOOR:
				UnlockDoor();
				break;

			case SLEEP:
				SleepMode();
				break;

			case ALARM_WAKEUP:
				AlarmWakeUpMode();
				break;
        
...
```

### 파일 트리 개선

아래와 같이 switch-case 문의 상태에 따른 동작들을 handlers 디렉터리에 정리하였습니다.

추후에는 프로젝트의

* 하드웨어 드라이버 모듈
* 하드웨어 점검 및 초기화 모듈
  * 하드웨어 리셋
  * 펌웨어 레지스터
* 에러 및 예외 처리 모듈
* 로그 출력 모듈
* 더미 데이터 출력 모듈
* 기능 테스트 모듈
* 통합 테스트 모듈

등으로 디렉터리를 구조화 및 정돈할 예정입니다.

![image-20251211190818008](C:\Users\bb\Desktop\refeed\ControllerProject\WorkSpace_Controller10\assets\image-20251211190818008.png)

### Git/GitHub를 통한 App 빌드 업무 개선

Flutter App 설치를 위한 GitHub 리포지토리를 생성하였고 App 설치 과정을 조금 더 편리하게 하였습니다.

추수에는 CI/CD를 통해 Git Push 만으로 App 빌드가 되도록 개선하겠습니다.